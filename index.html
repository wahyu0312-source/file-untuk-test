<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,viewport-fit=cover">
  <title>東京精密発條株式会社システム</title>
  <link rel="icon" href="assets/logo.png">
  <link rel="stylesheet" href="style.css">
  <script defer src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script defer src="https://unpkg.com/lucide@latest"></script>
  <script defer src="app.js"></script>
</head>
<body>
  <nav class="nav">
    <div class="nav-left"><img src="assets/logo.png" class="logo" alt=""><span class="brand">東京精密発條株式会社システム</span></div>
    <div class="nav-right">
      <button id="btnToDash" class="btn ghost hidden"><i data-lucide="layout-dashboard"></i>ダッシュ</button>
      <button id="btnToSales" class="btn ghost hidden"><i data-lucide="file-text"></i>受注</button>
      <button id="btnToPlan" class="btn ghost hidden"><i data-lucide="clipboard-list"></i>計画</button>
      <button id="btnToShip" class="btn ghost hidden"><i data-lucide="truck"></i>出荷</button>
      <button id="btnToInvoice" class="btn ghost hidden"><i data-lucide="file-invoice"></i>請求</button>
      <button id="btnToCharts" class="btn ghost hidden"><i data-lucide="pie-chart"></i>チャート</button>
      <button id="btnShowStationQR" class="btn ghost hidden"><i data-lucide="qr-code"></i>工程QR</button>
      <span id="userInfo" class="muted"></span>
      <button id="btnAddUserWeb" class="btn ghost hidden" title="ユーザー追加"><i data-lucide="user-plus"></i></button>
      <button id="btnChangePass" class="btn ghost hidden" title="パスワード変更"><i data-lucide="lock"></i></button>
      <button id="btnLogout" class="btn ghost hidden" title="ログアウト"><i data-lucide="log-out"></i></button>
    </div>
  </nav>

  <div id="loading" class="loading hidden"><div class="spinner"></div></div>

  <main id="authView" class="container">
    <section class="card card-tight">
      <h2>ログイン（スプレッドシートDB）</h2>
      <div class="grid m1"><input id="inUser" placeholder="ユーザー名"><input id="inPass" type="password" placeholder="パスワード"></div>
      <details class="card" style="margin-top:.8rem">
        <summary><strong>管理者: ユーザー追加</strong></summary>
        <div class="grid m1" style="margin-top:.6rem">
          <input id="nuUser" placeholder="ユーザー名"><input id="nuPass" type="password" placeholder="パスワード"><input id="nuName" placeholder="氏名">
          <select id="nuDept"><option>営業</option><option>生産技術</option><option>生産管理部</option><option>製造部</option><option>検査部</option></select>
          <select id="nuRole"><option>member</option><option>manager</option><option>admin</option></select>
        </div>
        <button id="btnNewUser" class="btn ghost full"><i data-lucide="user-plus"></i>ユーザー追加</button>
        <p class="muted s">初回: <code>admin / admin123</code></p>
      </details>
      <button id="btnLogin" class="btn primary full" style="margin-top:.8rem"><i data-lucide="log-in"></i>ログイン</button>
    </section>
  </main>

  <main id="pageDash" class="container hidden">
    <section class="card">
      <header class="row-between">
        <h3><i data-lucide="list"></i> 生産一覧</h3>
        <div class="row gap"><input id="searchQ" placeholder="検索（注番・品番…）" class="input">
          <button class="btn ghost" id="btnExportOrders"><i data-lucide="download"></i>注文CSV</button>
          <button class="btn ghost" id="btnExportShip"><i data-lucide="download"></i>本日出荷CSV</button>
        </div>
      </header>
      <div class="table-wrap" style="max-height:56vh">
        <table class="table s">
          <thead><tr>
            <th>注番</th><th>得意先</th><th>製番号</th><th>品名</th><th>品番</th><th>図番</th>
            <th>状態</th><th>工程</th><th>更新日時</th><th>更新者</th><th>操作</th>
          </tr></thead>
          <tbody id="tbOrders"></tbody>
        </table>
      </div>
    </section>

    <section class="card">
      <header class="row-between">
        <h3><i data-lucide="activity"></i> ダッシュボード</h3>
        <div class="row gap"><button class="btn ghost" id="btnRefresh"><i data-lucide="refresh-ccw"></i>更新</button><button class="btn ghost" onclick="window.print()"><i data-lucide="printer"></i>印刷</button></div>
      </header>

      <div class="grid-3">
        <div class="stat">
          <div class="muted s">完成品在庫</div>
          <div id="statFinished" class="stat-num">-</div>
          <div class="muted s"><span id="statReady">-</span> 準備 / <span id="statShipped">-</span> 出荷済</div>
        </div>

        <div class="tile">
          <div class="muted s">本日の出荷予定</div>
          <div id="listToday" class="list s"></div>
        </div>

        <div class="tile">
          <div class="muted s">工程内滞留（現在位置）</div>
          <div id="gridProc" class="grid grid-chips"></div>
        </div>

        <!-- 完成品在庫（明細） -->
        <div class="tile" style="grid-column: 1 / -1;">
          <div class="row-between">
            <div class="muted s">完成品在庫（明細）</div>
            <button id="btnExportFinished" class="btn ghost s"><i data-lucide="download"></i>CSV</button>
          </div>
          <div class="list s header-like">
            <div><span class="bold">注番・得意先</span><span class="bold right">品名／図番・数量</span></div>
          </div>
          <div id="listFinished" class="list s"></div>
        </div>
      </div>
    </section>
  </main>

  <!-- Dialogs minimal -->
  <dialog id="dlgHistory" class="paper"><div class="body"><h3>更新履歴</h3><div id="histBody"></div></div><footer class="row-end"><button class="btn" onclick="document.getElementById('dlgHistory').close()"><i data-lucide="x"></i>閉じる</button></footer></dialog>
  <dialog id="dlgTicket" class="paper"><div class="body"></div><footer class="row-end"><button class="btn ghost" onclick="window.print()"><i data-lucide="printer"></i>印刷</button><button class="btn" onclick="document.getElementById('dlgTicket').close()"><i data-lucide="x"></i>閉じる</button></footer></dialog>
  <dialog id="dlgShip" class="paper"><div class="body"></div><footer class="row-end"><button class="btn ghost" onclick="window.print()"><i data-lucide="printer"></i>印刷</button><button class="btn" onclick="document.getElementById('dlgShip').close()"><i data-lucide="x"></i>閉じる</button></footer></dialog>

  <script>document.addEventListener("DOMContentLoaded", ()=>{ if(window.lucide){ lucide.createIcons(); } });</script>
</body>
</html>
