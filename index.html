<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <title>東京精密発條株式会社システム</title>
  <link rel="icon" href="https://raw.githubusercontent.com/wahyuf-wd/tsh-erp-assets/main/tsh.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkfQ+DaZr7ePOYtWGbS6cXWf5Mrdk5lFZ9QXJd2r5PH8WPe9XgYj2RF6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="style.css">
  <script defer src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script defer src="app.js"></script>
</head>
<body>

<div id="loader" class="loader-overlay hidden">
  <div class="spinner"></div>
</div>
<footer class="footer">Design by Wahyu</footer>

<nav class="nav">
  <div class="nav-left">
    <img src="https://raw.githubusercontent.com/wahyuf-wd/tsh-erp-assets/main/tsh.png" class="logo" alt="">
    <span class="brand">東京精密発條株式会社システム</span>
  </div>
  <div class="nav-right">
    <button id="btnToDash" class="btn ghost hidden"><i class="fa-solid fa-table-columns"></i> 総合一覧</button>
    <button id="btnToInventory" class="btn ghost hidden"><i class="fa-solid fa-boxes-stacked"></i> 在庫 (WIP)</button>
    <button id="btnToFinished" class="btn ghost hidden"><i class="fa-solid fa-box-archive"></i> 完成品一覧</button>
    <button id="btnToSales" class="btn ghost hidden"><i class="fa-regular fa-handshake"></i> 受注</button>
    <button id="btnToPlan" class="btn ghost hidden"><i class="fa-solid fa-list-check"></i> 生産計画</button>
    <button id="btnToShip" class="btn ghost hidden"><i class="fa-solid fa-truck"></i> 出荷予定</button>
    <button id="btnToInvoice" class="btn ghost hidden"><i class="fa-regular fa-file-lines"></i> 請求書</button>
    <button id="btnToCharts" class="btn ghost hidden"><i class="fa-solid fa-chart-simple"></i> 統計</button>
    <details class="dropdown-inline hidden" id="ddSetting">
      <summary class="btn ghost">
        <i class="fa-solid fa-gear"></i> 設定 <i class="fa-solid fa-caret-down caret"></i>
      </summary>
      <div class="menu right">
        <button id="miStationQR" class="menu-item"><i class="fa-solid fa-qrcode"></i> 工程QR</button>
        <button id="miAddUser" class="menu-item"><i class="fa-solid fa-user-plus"></i> ユーザー追加</button>
        <button id="miChangePass" class="menu-item"><i class="fa-solid fa-key"></i> パス変更</button>
        <hr>
        <button id="btnLogout" class="menu-item"><i class="fa-solid fa-right-from-bracket"></i> ログアウト</button>
      </div>
    </details>
    <span id="userInfo" class="muted"></span>
  </div>
</nav>

<main id="authView" class="container">
  <section class="card card-tight">
    <h2><i class="fa-solid fa-right-to-bracket"></i> ログイン</h2>
    <div class="grid-1">
      <input id="inUser" placeholder="ユーザー名">
      <input id="inPass" type="password" placeholder="パスワード">
    </div>
    <button id="btnLogin" class="btn primary full" style="margin-top:.8rem">ログイン</button>
  </section>
</main>

<main id="pageDash" class="container hidden">
  <section class="card">
    <header class="row-between">
      <h3><i class="fa-solid fa-table-columns"></i> オーダー一覧 (総合)</h3>
      <div class="row gap">
        <input id="searchQ" placeholder="検索..." class="input">
        <button class="btn ghost" id="btnExportOrders"><i class="fa-solid fa-file-csv"></i> CSV出力</button>
        <button class="btn ghost" id="btnRefresh"><i class="fa-solid fa-rotate"></i> 更新</button>
      </div>
    </header>
    <div class="table-wrap">
      <table class="table s">
        <thead>
          <tr>
            <th>注番 / 得意先</th><th>品名</th><th>品番</th><th>図番</th><th>状態</th><th>工程</th><th>更新日時</th><th>更新者</th><th>操作</th>
          </tr>
        </thead>
        <tbody id="tbOrders"></tbody>
      </table>
    </div>
  </section>
  <section class="card">
    <header><h3><i class="fa-solid fa-gauge"></i> ダッシュボード</h3></header>
    <div class="grid-3">
      <div class="tile">
        <div class="muted s">完成品在庫</div>
        <div id="statFinished" class="stat-num">-</div>
        <div class="muted s"><span id="statReady">-</span> 準備 / <span id="statShipped">-</span> 出荷済</div>
      </div>
      <div class="tile">
        <div class="muted s">本日の出荷予定</div>
        <div id="listToday" class="list s"></div>
      </div>
      <div class="tile">
        <div class="muted s">工程内滞留 (WIP)</div>
        <div id="gridProc" class="grid grid-chips"></div>
      </div>
    </div>
  </section>
</main>

<main id="pageInventory" class="container hidden">
  <section class="card">
    <header class="row-between">
      <h3><i class="fa-solid fa-boxes-stacked"></i> 在庫一覧 (WIP)</h3>
      <div class="row gap">
        <input id="searchInventory" placeholder="検索..." class="input">
      </div>
    </header>
    <div class="table-wrap">
      <table class="table s">
        <thead>
          <tr>
            <th>注番 / 得意先</th><th>品名</th><th>品番</th><th>図番</th><th>状態</th><th>工程</th><th>更新日時</th><th>更新者</th><th>操作</th>
          </tr>
        </thead>
        <tbody id="tbInventory"></tbody>
      </table>
    </div>
  </section>
</main>

<main id="pageFinished" class="container hidden">
  <section class="card">
    <header class="row-between">
      <h3><i class="fa-solid fa-box-archive"></i> 完成品一覧</h3>
      <div class="row gap">
        <input id="searchFinished" placeholder="検索..." class="input">
      </div>
    </header>
    <div class="table-wrap">
      <table class="table s">
        <thead>
          <tr>
            <th>注番 / 得意先</th><th>品名</th><th>品番</th><th>図番</th><th>状態</th><th>工程</th><th>更新日時</th><th>更新者</th><th>操作</th>
          </tr>
        </thead>
        <tbody id="tbFinished"></tbody>
      </table>
    </div>
  </section>
</main>

<main id="pageSales" class="container hidden">
  <section class="card">
    <header class="row-between">
      <h3><i class="fa-regular fa-handshake"></i> 受注 (営業) 入力</h3>
      <div class="row gap">
        <button class="btn primary" id="btnSalesSave"><i class="fa-solid fa-floppy-disk"></i> 保存</button>
        <button class="btn" id="btnSalesDelete"><i class="fa-solid fa-trash-can"></i> 削除</button>
        <button class="btn ghost" id="btnPromote"><i class="fa-solid fa-arrow-right-arrow-left"></i> 計画に変換</button>
      </div>
    </header>
    <div class="grid-2">
      <input id="so_id" placeholder="SO ID (編集/削除用)">
      <input id="so_date" type="date" placeholder="受注日">
      <input id="so_cust" placeholder="得意先" list="dl_tokui">
      <input id="so_item" placeholder="品名" list="dl_hinmei">
      <input id="so_part" placeholder="品番" list="dl_hinban">
      <input id="so_drw" placeholder="図番" list="dl_zuban">
      <input id="so_sei" placeholder="製番号">
      <input id="so_qty" type="number" placeholder="数量">
      <input id="so_req" type="date" placeholder="希望納期">
      <input id="so_note" placeholder="備考">
    </div>
  </section>
  <section class="card">
    <header class="row-between">
      <h3><i class="fa-regular fa-rectangle-list"></i> 受注一覧</h3>
      <div class="row gap">
        <input id="salesQ" placeholder="検索..." class="input">
        <label for="importSales" class="btn ghost"><i class="fa-solid fa-file-import"></i> Import CSV</label>
        <input type="file" id="importSales" accept=".csv" class="hidden">
        <button class="btn ghost" id="btnSalesExport"><i class="fa-solid fa-file-csv"></i> CSV出力</button>
      </div>
    </header>
    <div class="table-wrap">
      <table class="table s">
        <thead>
          <tr><th>SO</th><th>受注日</th><th>得意先</th><th>品名</th><th>品番/図番</th><th>数量</th><th>希望納期</th><th>状態</th><th>PO</th><th>更新</th></tr>
        </thead>
        <tbody id="tbSales"></tbody>
      </table>
    </div>
  </section>
</main>

<main id="pagePlan" class="container hidden">
  <section class="card">
    <header class="row-between">
      <h3><i class="fa-solid fa-list-check"></i> 生産計画 (生産現品票)</h3>
      <div class="row gap">
        <button class="btn ghost" id="btnPlanEdit"><i class="fa-solid fa-pen-to-square"></i> 読込</button>
        <button class="btn primary" id="btnCreateOrder"><i class="fa-solid fa-floppy-disk"></i> 保存</button>
        <button class="btn" id="btnPlanDelete"><i class="fa-solid fa-trash-can"></i> 削除</button>
        <label for="importPlan" class="btn ghost"><i class="fa-solid fa-file-import"></i> Import CSV</label>
        <input type="file" id="importPlan" accept=".csv" class="hidden">
      </div>
    </header>
    <div class="grid-2">
      <input id="c_po" placeholder="PO (編集/削除用)">
      <input id="c_tsuchi" placeholder="通知書番号">
      <input id="c_tokui" placeholder="得意先" list="dl_tokui">
      <input id="c_tokui_hin" placeholder="得意先品番">
      <input id="c_sei" placeholder="製番号">
      <input id="c_hinmei" placeholder="品名" list="dl_hinmei">
      <input id="c_hinban" placeholder="品番" list="dl_hinban">
      <input id="c_zuban" placeholder="図番" list="dl_zuban">
      <input id="c_kanri" placeholder="管理No">
    </div>
    <datalist id="dl_tokui"></datalist>
    <datalist id="dl_hinmei"></datalist>
    <datalist id="dl_hinban"></datalist>
    <datalist id="dl_zuban"></datalist>
  </section>
</main>

<main id="pageShip" class="container hidden">
  <section class="card">
    <header class="row-between">
      <h3><i class="fa-solid fa-truck"></i> 出荷予定 / 出荷確認</h3>
      <div class="row gap">
        <button class="btn ghost" id="btnShipEdit"><i class="fa-solid fa-pen-to-square"></i> 読込</button>
        <button class="btn primary" id="btnSchedule"><i class="fa-solid fa-floppy-disk"></i> 保存</button>
        <button class="btn" id="btnShipDelete"><i class="fa-solid fa-trash-can"></i> 削除</button>
        <label for="importShip" class="btn ghost"><i class="fa-solid fa-file-import"></i> Import CSV</label>
        <input type="file" id="importShip" accept=".csv" class="hidden">
      </div>
    </header>
    <div class="grid-2">
      <input id="s_po" placeholder="PO ID">
      <input id="s_date" type="date">
      <input id="s_qty" type="number" min="0" placeholder="数量">
      <input id="s_shipid" placeholder="Ship ID (編集/削除用)">
    </div>
    <div class="row gap" style="margin-top: .8rem;">
      <button id="btnShipByPO" class="btn ghost grow"><i class="fa-regular fa-file-lines"></i> 出荷確認書 (PO)</button>
      <button id="btnShipByID" class="btn ghost grow"><i class="fa-regular fa-file-lines"></i> 出荷確認書 (Ship ID)</button>
    </div>
  </section>
</main>

<main id="pageInvoice" class="container hidden">
  <section class="card">
    <header class="row-between">
      <h3><i class="fa-regular fa-file-lines"></i> 請求書作成</h3>
      <div class="row gap">
        <button id="btnInvPreview" class="btn ghost"><i class="fa-solid fa-calculator"></i> 集計</button>
        <button id="btnInvCreate" class="btn primary"><i class="fa-solid fa-stamp"></i> 発行</button>
        <button id="btnInvPrint" class="btn ghost"><i class="fa-solid fa-print"></i> 印刷</button>
        <button id="btnInvCSV" class="btn ghost"><i class="fa-solid fa-file-csv"></i> CSV出力</button>
      </div>
    </header>
    <div class="grid-3">
      <input id="inv_customer" placeholder="得意先" list="dl_tokui">
      <input id="inv_from" type="date" placeholder="期間自">
      <input id="inv_to" type="date" placeholder="期間至">
      <input id="inv_date" type="date" placeholder="請求日">
      <input id="inv_currency" placeholder="通貨" value="JPY">
      <input id="inv_memo" placeholder="メモ">
    </div>
  </section>
  <section class="card">
    <h3>請求明細 (単価は編集可)</h3>
    <div class="table-wrap">
      <table class="table s" id="tblInv">
        <thead>
          <tr><th>#</th><th>品名</th><th>品番</th><th>図番</th><th>数量</th><th>単価</th><th>金額</th><th>PO</th><th>出荷ID</th></tr>
        </thead>
        <tbody id="invLines"></tbody>
        <tfoot>
          <tr><td colspan="5"></td><td class="muted">小計</td><td id="invSub">0</td><td colspan="2"></td></tr>
          <tr><td colspan="5"></td><td class="muted">税額(10%)</td><td id="invTax">0</td><td colspan="2"></td></tr>
          <tr><td colspan="5"></td><td><b>合計</b></td><td id="invTotal"><b>0</b></td><td colspan="2"></td></tr>
        </tfoot>
      </table>
    </div>
  </section>
</main>

<main id="pageCharts" class="container hidden">
  <section class="card">
    <header class="row-between">
      <h3><i class="fa-solid fa-chart-simple"></i> 統計</h3>
      <div class="row gap">
        <select id="chartYear" class="input" style="width:120px"></select>
        <button id="btnChartsRefresh" class="btn ghost"><i class="fa-solid fa-rotate"></i> 更新</button>
      </div>
    </header>
    <div class="grid-3">
      <div class="tile"><div class="muted s">月別出荷数量</div><div style="height:220px"><canvas id="chMonthly"></canvas></div></div>
      <div class="tile"><div class="muted s">得意先別出荷</div><div style="height:220px"><canvas id="chCustomer"></canvas></div></div>
      <div class="tile"><div class="muted s">在庫区分</div><div style="height:220px"><canvas id="chStock"></canvas></div></div>
      <div class="tile"><div class="muted s">工程内WIP</div><div style="height:220px"><canvas id="chWipProc"></canvas></div></div>
      <div class="tile"><div class="muted s">営業 受注数</div><div style="height:220px"><canvas id="chSales"></canvas></div></div>
      <div class="tile"><div class="muted s">生産計画 作成数</div><div style="height:220px"><canvas id="chPlan"></canvas></div></div>
    </div>
  </section>
</main>

<dialog id="dlgStationQR" class="paper">
  <div class="body"><h3>工程QR (現場掲示用)</h3><p class="muted s">フォーマット: <code>ST:工程名</code></p><div id="qrWrap" class="grid-3"></div></div>
  <footer class="row-end"><button class="btn" onclick="this.closest('dialog').close()">閉じる</button></footer>
</dialog>
<dialog id="dlgScan" class="paper">
  <div class="body">
    <h3>QRスキャン更新 (PO: <span id="scanPO"></span>)</h3>
    <p class="muted s">工程QRを読み取ると自動で更新され、履歴に記録されます。</p>
    <video id="scanVideo" playsinline></video>
    <canvas id="scanCanvas" class="hidden"></canvas>
    <div id="scanResult" class="muted s" style="margin-top:.5rem"></div>
  </div>
  <footer class="row-end"><button class="btn ghost" id="btnScanStart">開始</button><button class="btn" id="btnScanClose">閉じる</button></footer>
</dialog>
<dialog id="dlgHistory" class="paper"><div class="body"><h3>更新履歴</h3><div id="histBody"></div></div><footer class="row-end"><button class="btn" onclick="this.closest('dialog').close()">閉じる</button></footer></dialog>
<dialog id="dlgTicket" class="paper"><div class="body"></div><footer class="row-end"><button class="btn ghost" onclick="window.print()"><i class="fa-solid fa-print"></i> 印刷</button><button class="btn" onclick="this.closest('dialog').close()">閉じる</button></footer></dialog>
<dialog id="dlgShip" class="paper"><div class="body"></div><footer class="row-end"><button class="btn ghost" onclick="window.print()"><i class="fa-solid fa-print"></i> 印刷</button><button class="btn" onclick="this.closest('dialog').close()">閉じる</button></footer></dialog>

</body>
</html>
