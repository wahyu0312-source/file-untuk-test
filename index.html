<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <title>東京精密発條株式会社システム</title>
  <link rel="icon" href="assets/tsh.png">
  <link rel="stylesheet" href="style.css">
  <!-- Material Icons untuk ikon navigasi -->
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@400;700" rel="stylesheet" />
  <!-- Chart.js -->
  <script defer src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <!-- QR libs -->
  <script defer src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <!-- App -->
  <script defer src="app.js"></script>
  <style>
    /* Penyesuaian kecil ikon */
    .mi{font-family:"Material Symbols Outlined";font-weight:400;font-style:normal;font-size:18px;line-height:1;display:inline-flex;vertical-align:middle}
    .nav .btn .mi{font-size:18px;margin-right:.25rem}
    /* Grid chart responsif */
    .charts-grid{display:grid;grid-template-columns:1fr;gap:1rem}
    @media(min-width:900px){ .charts-grid{grid-template-columns:1fr 1fr} }
    @media(min-width:1400px){ .charts-grid{grid-template-columns:1fr 1fr 1fr} }
    .chart-card{background:#fff;border:1px solid var(--border);border-radius:12px;padding:12px;box-shadow:var(--shadow);min-height:320px}
    .chart-wrap{position:relative;width:100%;height:320px}
    @media(min-width:1600px){ .chart-wrap{height:420px} }         /* TV/monitor besar */
    @media(min-width:2200px){ .chart-wrap{height:520px} }         /* 4K */
  </style>
</head>
<body>
  <nav class="nav">
    <div class="nav-left">
      <img src="assets/tsh.png" class="logo" alt="">
      <span class="brand">東京精密発條株式会社システム</span>
    </div>
    <div class="nav-right">
      <button id="btnToDash" class="btn ghost hidden"><span class="mi">dashboard</span>ダッシュボード</button>
      <button id="btnToSales" class="btn ghost hidden"><span class="mi">assignment</span>受注（営業）</button>
      <button id="btnToPlan"  class="btn ghost hidden"><span class="mi">precision_manufacturing</span>生産計画</button>
      <button id="btnToShip"  class="btn ghost hidden"><span class="mi">local_shipping</span>出荷予定</button>
      <button id="btnToInvoice" class="btn ghost hidden"><span class="mi">receipt_long</span>請求書</button>
      <button id="btnToCharts" class="btn ghost hidden"><span class="mi">monitoring</span>統計</button>
      <button id="btnShowStationQR" class="btn ghost hidden"><span class="mi">qr_code_2</span>工程QR</button>
      <span id="userInfo" class="muted"></span>
      <button id="btnAddUserWeb" class="btn ghost hidden"><span class="mi">person_add</span>ユーザー追加</button>
      <button id="btnChangePass" class="btn ghost hidden"><span class="mi">lock</span>パス変更</button>
      <button id="btnLogout" class="btn ghost hidden"><span class="mi">logout</span>ログアウト</button>
    </div>
  </nav>

  <!-- Auth -->
  <main id="authView" class="container">
    <section class="card card-tight">
      <h2>ログイン</h2>
      <div class="grid">
        <input id="inUser" placeholder="ユーザー名">
        <input id="inPass" type="password" placeholder="パスワード">
      </div>
      <details class="card" style="margin-top:.8rem">
        <summary><strong>管理者: ユーザー追加</strong></summary>
        <div class="grid" style="margin-top:.6rem">
          <input id="nuUser" placeholder="ユーザー名">
          <input id="nuPass" type="password" placeholder="パスワード">
          <input id="nuName" placeholder="氏名">
          <select id="nuDept">
            <option value="営業">営業</option>
            <option value="生産技術">生産技術</option>
            <option value="生産管理部">生産管理部</option>
            <option value="製造部">製造部</option>
            <option value="検査部">検査部</option>
          </select>
          <select id="nuRole"><option value="member">member</option><option value="manager">manager</option><option value="admin">admin</option></select>
        </div>
        <button id="btnNewUser" class="btn ghost full">ユーザー追加</button>
        <p class="muted s">初回: <code>admin / admin123</code>（Users空なら自動作成。部門=生産技術）</p>
      </details>
      <button id="btnLogin" class="btn primary full" style="margin-top:.8rem">ログイン</button>
    </section>
  </main>

  <!-- Dashboard (TANPA CHART) -->
  <main id="pageDash" class="container hidden">
    <section class="card" id="ordersSection">
      <header class="row-between">
        <h3>オーダー一覧</h3>
        <div class="row gap">
          <input id="searchQ" placeholder="検索..." class="input">
          <button class="btn ghost" id="btnExportOrders"><span class="mi">table_view</span>注文CSV</button>
          <button class="btn ghost" id="btnExportShip"><span class="mi">download</span>本日出荷CSV</button>
        </div>
      </header>
      <div class="table-wrap" style="max-height:55vh">
        <table class="table s">
          <thead><tr>
            <th>注番</th><th>得意先</th><th>製番号</th><th>品名</th><th>品番</th><th>図番</th>
            <th>状態</th><th>工程</th><th>更新日時</th><th>更新者</th><th>操作</th>
          </tr></thead>
          <tbody id="tbOrders"></tbody>
        </table>
      </div>
    </section>

    <section class="card">
      <header class="row-between">
        <h3>ダッシュボード</h3>
        <div class="row gap">
          <button class="btn ghost" id="btnRefresh"><span class="mi">refresh</span>更新</button>
          <button class="btn ghost" onclick="window.print()"><span class="mi">print</span>印刷</button>
        </div>
      </header>
      <div class="grid-3">
        <div class="stat"><div class="muted s">完成品在庫</div><div id="statFinished" class="stat-num">-</div><div class="muted s"><span id="statReady">-</span> 準備 / <span id="statShipped">-</span> 出荷済</div></div>
        <div class="tile"><div class="muted s">本日の出荷予定</div><div id="listToday" class="list s"></div></div>
        <div class="tile"><div class="muted s">工程内滞留（現在位置）</div><div id="gridProc" class="grid grid-chips"></div></div>
      </div>
    </section>
  </main>

  <!-- Sales -->
  <main id="pageSales" class="container hidden">
    <!-- … (TIDAK BERUBAH, biarkan sesuai file Anda) … -->
  </main>

  <!-- Plan -->
  <main id="pagePlan" class="container hidden">
    <!-- … -->
  </main>

  <!-- Ship -->
  <main id="pageShip" class="container hidden">
    <!-- … -->
  </main>

  <!-- Invoice -->
  <main id="pageInvoice" class="container hidden">
    <!-- … -->
  </main>

  <!-- ====== NEW: Charts page ====== -->
  <main id="pageCharts" class="container hidden">
    <section class="card">
      <header class="row-between">
        <h3><span class="mi">monitoring</span>&nbsp;統計（Chart Visualisasi）</h3>
        <div class="row gap">
          <select id="chartYear" class="input" style="width:140px"></select>
          <button class="btn ghost" id="btnChartsRefresh"><span class="mi">refresh</span>再取得</button>
        </div>
      </header>

      <div class="charts-grid">
        <div class="chart-card">
          <div class="muted s">月別出荷数量</div>
          <div class="chart-wrap"><canvas id="chMonthly"></canvas></div>
        </div>
        <div class="chart-card">
          <div class="muted s">得意先別出荷</div>
          <div class="chart-wrap"><canvas id="chCustomer"></canvas></div>
        </div>
        <div class="chart-card">
          <div class="muted s">在庫区分（検査済/出荷準備/出荷済）</div>
          <div class="chart-wrap"><canvas id="chStock"></canvas></div>
        </div>
        <div class="chart-card">
          <div class="muted s">工程内WIP（現行工程）</div>
          <div class="chart-wrap"><canvas id="chWipProc"></canvas></div>
        </div>
        <div class="chart-card">
          <div class="muted s">受注（営業）月別</div>
          <div class="chart-wrap"><canvas id="chSales"></canvas></div>
        </div>
        <div class="chart-card">
          <div class="muted s">生産計画（現品票作成）月別</div>
          <div class="chart-wrap"><canvas id="chPlan"></canvas></div>
        </div>
      </div>
    </section>
  </main>

  <!-- Dialogs (tetap) -->
  <dialog id="dlgStationQR" class="paper">…</dialog>
  <dialog id="dlgScan" class="paper">…</dialog>
  <dialog id="dlgHistory" class="paper">…</dialog>
  <dialog id="dlgTicket" class="paper">…</dialog>
  <dialog id="dlgShip" class="paper">…</dialog>
</body>
</html>
